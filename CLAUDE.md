# FounderFlow: Claude AI Project Brief
Snapshot date: 2026-02-10

## Intent of this document
This file explains the current FounderFlow codebase in detail and highlights concrete gaps so Claude can propose and implement improvements safely. Treat this as the source of truth for what is in the repo today. Some older docs describe aspirational features that are not implemented.

## Product summary
FounderFlow is an AI-first startup operating system for early stage founders. It provides onboarding, idea validation, roadmap planning, task execution, pitch deck generation, market intelligence, and founder networking. The core value is AI guided structure for a startup from idea to execution.

## Current status at a glance
- Implemented today: onboarding, founder dashboard, idea validation, roadmap generation, task execution via AI, canvas editor, pitch deck generator, market intel UI, weekly review UI, timeline (startup memory), messaging between founders, admin portal for users and startups.
- Partially implemented or demo only: market intel data, weekly review insights, pivot simulation UI, AI sidekick chat panels, RAG long term memory. These are mostly static or simulated.
- Not fully wired: Postgres and pgvector RAG system, investor portal and deal workflow, real time external market and regulatory data.
- Docs to treat as aspirational: docs/ARCHITECTURE.md and docs/ROADMAP.md mention investor portal, Postgres RAG, and other features that are not in the code yet.

## Tech stack
- Next.js 16.1.3 App Router
- React 19.2.3
- Tailwind CSS 4 and tailwind-merge
- Framer Motion for animations
- Firebase Auth, Firestore, and Storage
- Google Gemini via @google/generative-ai
- Optional and not wired: Postgres with pgvector

## High level architecture
- UI layer: App Router pages in src/app. Most pages are client components and talk directly to Firestore or API routes.
- Service layer: src/lib for Firebase access, startup services, admin services, and AI agent orchestration.
- API layer: src/app/api for Gemini powered operations that should run server side.
- Data layer: Firestore for operational data, Storage for profile images. A planned Postgres RAG system exists in src/lib/rag but is not connected.

## Repo map
- src/app: Next.js routes, pages, and API endpoints.
- src/components: Shared UI, Sidebar, MessagingHub, ProfileEditor.
- src/context: AuthContext for Firebase auth state.
- src/hooks: useStartup hook for real time Firestore subscriptions.
- src/lib: Firebase setup, service layer, AI agents, admin auth, connections, messaging, and RAG stubs.
- docs: README, setup, architecture, roadmap.
- scripts: wipe-db.ts for destructive Firestore cleanup.

## Key runtime flow
User input on client page -> Firestore read or POST to API route -> API route uses Gemini -> results persisted to Firestore -> UI renders from Firestore or direct response.

## Firestore collections
- users: founder profile, role, activeStartupId, onboarding status, demographic segment, profile data.
- startups: core startup entity with name, industry, idea, stage, ownerId, projectStatus, and optional fields like oneSentencePitch.
- startup_members: membership and role for multi user startups.
- startupMemory: append only log of decisions and AI outputs.
- tasks: execution tasks with AI response, status, priority, and metadata.
- agentRuns: audit log for AI agent operations.
- roadmaps: generated roadmap phases and goals.
- canvases: rich text blocks for the canvas editor. Note that Canvas uses doc id {startupId}_main.
- pitchDecks: slides generated by AI.
- marketIntel: competitor list and updates.
- connections: accepted founder connections.
- connection_requests: pending requests between founders.
- chat_rooms: chat metadata for direct chats.
- chats/{chatId}/messages: message subcollection.

## Authentication and authorization
- Founder auth: Firebase Auth with Google and email password. AuthContext subscribes to users/{uid} for profile and onboarding state.
- Admin auth: server-side credentials via ADMIN_USERNAME / ADMIN_PASSWORD and a signed httpOnly session cookie (founderflow_admin_session) checked in middleware and admin APIs.
- Authorization: API routes verify Firebase ID tokens and validate startup membership before accessing data.

## Core user journey
- Landing page: src/app/page.tsx. Marketing only.
- Login and signup: src/app/login/page.tsx. Creates users doc on signup.
- Onboarding: src/app/onboarding/page.tsx. Collects founder intake, generates a first 48 hour plan locally, creates startup and tasks in Firestore.
- Dashboard: src/app/founder/dashboard/page.tsx. Reads tasks and memory to show metrics and primary action.
- Idea validation: src/app/founder/idea-validation/page.tsx plus /api/validate-idea. Creates a validation report stored in startupMemory and may advance stage to idea_validated.
- Roadmap: two routes exist. src/app/founder/planning/page.tsx shows a 3 phase roadmap view. src/app/founder/roadmap/page.tsx shows a detailed roadmap with phases, goals, and milestones saved to roadmaps/{startupId}.
- Tasks: src/app/founder/tasks/page.tsx. Shows pending and completed tasks. Run Sprint triggers /api/execute-task for each pending task.
- Canvas: src/app/founder/canvas/page.tsx. Rich block editor that autosaves to canvases/{startupId}_main.
- Pitch deck: src/app/founder/pitch-deck/page.tsx and /api/generate-pitch-deck. Generates slides and stores them in pitchDecks/{startupId}.
- Market intel: src/app/founder/market-intel/page.tsx. Mostly sample data and competitor tracking saved to marketIntel/{startupId}.
- Weekly review: src/app/founder/weekly-review/page.tsx. Uses sample data and local pivot simulation.
- Timeline: src/app/founder/timeline/page.tsx. Reads startupMemory in reverse chronological order.
- Messaging: src/app/founder/chats/page.tsx and MessagingHub. Uses connections and chat_rooms with real time updates.
- Profile: src/app/founder/profile/page.tsx and ProfileEditor. Stores profile fields in users collection and uploads avatar or banner to Firebase Storage.
- Projects: src/app/projects/page.tsx and src/app/projects/create/page.tsx for multi project selection and creation.

## API routes
Route: /api/validate-idea
Purpose: Validate idea with Gemini and store output in startupMemory. Updates stage to idea_validated if score > 40.
Input: { startupId, idea, userId }
Output: JSON report with scoring, summary, risks, suggestions, and other fields.

Route: /api/generate-roadmap
Purpose: Generate a 4 phase roadmap with milestones and save to startupMemory. Updates stage to roadmap_created.
Input: { startupId, idea, context }
Output: JSON with roadmap object.

Route: /api/generate-tasks
Purpose: Convert strategy or idea into tasks and store them in tasks collection.
Input: { startupId, idea or strategy }
Output: { success, count }

Route: /api/execute-task
Purpose: Run Gemini on a task instruction and store aiResponse. Marks task status done.
Input: { taskId, instruction, startupId }
Output: { success, aiResponse }

Route: /api/generate-first-48-hours
Purpose: Generate a first 48 hour plan and create tasks. Not called by onboarding yet.
Input: { startupId, founderBackground, problemStatement, targetDemographic, industry, idea }
Output: { success, plan, tasks }

Route: /api/generate-pitch-deck
Purpose: Generate a 7 slide deck based on startup data and memory.
Input: { startupId }
Output: { slides: [...] }

Route: /api/simulate-pivot
Purpose: Analyze a pivot scenario and return an impact report.
Input: { startupId, scenario }
Output: { simulation: { description, impact, recommendation } }

Route: /api/health
Purpose: Health check and deploy version.
Output: { status, timestamp, version }

Route: /api/admin/delete-user
Purpose: Delete a Firebase Auth user with Admin SDK.
Input: { uid }
Output: { success, message }

## AI and agent system
- Agent config in src/lib/agents/agent-system.ts with executor, validator, planner. These build prompts and call callGemini.
- Gemini client in src/lib/gemini.ts with model fallback list and JSON parsing via regex.
- validateIdea, generateRoadmap, generateTasks parse JSON from LLM output with regex. This can fail silently and return empty structuredData.

## RAG system status
- The RAG system in src/lib/rag is extensive but is a mock implementation.
- Database client uses placeholders and logs instead of real Postgres queries.
- generateEmbedding returns random vectors and is not connected to a real embedding model.
- Nothing in the UI or API routes uses this RAG system today.

## Admin system
- Admin login at /internal-admin-login uses client side credentials and sets a cookie.
- Admin layout protects /admin routes via middleware that checks only the cookie.
- Admin pages: overview stats, user registry, startup registry, and messaging hub.
- admin-service can delete startup data from Firestore but does not delete Firebase Auth users. /api/admin/delete-user can remove Auth users if Admin SDK is configured.

## Environment variables
- NEXT_PUBLIC_FIREBASE_API_KEY
- NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
- NEXT_PUBLIC_FIREBASE_PROJECT_ID
- NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
- NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
- NEXT_PUBLIC_FIREBASE_APP_ID
- GEMINI_API_KEY
- Admin credentials are now server-only (ADMIN_USERNAME / ADMIN_PASSWORD) with a signed session cookie.
- scripts/wipe-db.ts expects FIREBASE_CLIENT_EMAIL and FIREBASE_PRIVATE_KEY for Admin SDK.

## Build and run
- Install: npm install
- Dev: npm run dev
- Build: npm run build
- Start: npm run start
- No automated tests are present.

## Known gaps and inconsistencies to fix
- Admin security is not safe. Client side credentials and a simple cookie check allow easy bypass. Move admin auth server side and use HTTP only cookies.
- API routes trust userId and startupId from the client. Add Firebase ID token verification and membership checks.
- Planning page expects a roadmap shape { phases, pros, cons } but /api/generate-roadmap returns { roadmap }. This breaks planning.
- There are two roadmap UIs with different data models. Decide on one and consolidate.
- Pitch deck API reads canvases/{startupId} but canvas is saved as canvases/{startupId}_main. This makes pitch deck miss canvas context.
- Onboarding generates first 48 hour tasks locally and does not call /api/generate-first-48-hours. Decide which source of truth to use.
- execute-task marks tasks as done but does not set completedAt, so dashboard weekly metrics do not count AI completed tasks.
- The startup type requires oneSentencePitch and targetDemographic but createStartup does not always set them. Many pages assume these fields exist.
- ProfileEditor stores skills as a string, while FounderProfile type says skills is string array. Normalize.
- Market intel and weekly review use static demo data and are not persisted beyond limited Firestore fields.
- RAG system is stubbed and not connected to any UI or API route.
- docs/ARCHITECTURE.md and docs/ROADMAP.md include investor and Postgres features not in the repo. Align docs or implement features.
- .env.example contains real looking keys. Replace with placeholders and rotate keys if they are active.
- Multiple files contain encoding artifacts like ?? and ???. Convert files to UTF-8 clean text.

## Suggested improvement plan
### P0 Security and integrity
- Implement Firebase ID token verification in all API routes and enforce startup membership before any read or write.
- Replace admin auth with server side login, HTTP only cookies, and role checks. Consider Firebase custom claims.
- Add Firestore security rules to enforce collection access at the database level.

### P1 Product flow alignment
- Unify roadmap generation and display. Pick one schema and update planning and roadmap pages to use the same data.
- Fix canvas to pitch deck linkage by using the correct canvas doc id or by standardizing the doc id.
- Decide whether onboarding uses /api/generate-first-48-hours or a local plan, then remove the other path.
- Add completedAt when a task is marked done and update first48HoursPlan completion percentage.

### P2 AI and data quality
- Improve JSON parsing with schema validation and retries if Gemini output is not valid JSON.
- Add rate limiting and input sanitization to API routes that call Gemini.
- Wire the RAG system to a real Postgres database or remove the unused code to reduce confusion.

### P3 Product depth
- Replace market intel sample data with real data sources or label the page as demo only.
- Wire weekly review to actual tasks, memory, and pivot simulation via /api/simulate-pivot.
- Add export or PDF for roadmaps and weekly review similar to idea validation.

### P4 Observability and testing
- Add basic integration tests for API routes and Firestore service functions.
- Add error tracking and structured logging for server routes.
- Add performance monitoring for Gemini calls and Firestore queries.

## Guidance for Claude when modifying
- Prefer updating src/lib/startup-service.ts for Firestore operations instead of duplicating logic in pages.
- Use AuthContext and useStartup for authentication and data subscriptions in client pages.
- Keep App Router conventions. API routes live in src/app/api.
- When changing data models, update types in src/lib/types/founder.ts and update all affected pages.
- If you add new AI agents, extend src/lib/agents/agent-system.ts and surface results in startupMemory.
- After any schema change, update firestore.indexes.json if queries require it.

## Useful file references
- src/lib/gemini.ts for Gemini calls
- src/lib/agents/agent-system.ts for agent prompts and outputs
- src/lib/startup-service.ts for Firestore operations
- src/hooks/useStartup.ts for real time subscriptions
- src/app/api for server routes
- src/app/founder for the main UI
- src/components/messaging and src/lib/messaging-service.ts for chat
- docs/SETUP.md for environment setup
